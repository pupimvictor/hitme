apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

commonLabels:
  app: hey-benchmark

resources:
  - hitme-job.yaml
  
images:
- name: hitme
  newName: pupimvictor/hitme
  newTag: latest

configMapGenerator:
  - name: hey-config
    literals:
      - HEY_N=100000
      - HEY_C=100
      - HEY_M=GET
      - HEY_TARGET=phpdemo.afcucorp.local

patches:
  - target:
      kind: Job
      name: hey-job
    patch: |
      - op: replace
        path: /spec/template/spec/containers/0/env
        value:
          - name: HEY_N
            valueFrom:
              configMapKeyRef:
                name: hey-config
                key: HEY_N
          - name: HEY_C
            valueFrom:
              configMapKeyRef:
                name: hey-config
                key: HEY_C
          - name: HEY_M
            valueFrom:
              configMapKeyRef:
                name: hey-config
                key: HEY_M
          - name: HEY_TARGET
            valueFrom:
              configMapKeyRef:
                name: hey-config
                key: HEY_TARGET
